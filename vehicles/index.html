<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vehicle Assets | Mahindra Emirates</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Centralized styles -->
    <link rel="stylesheet" href="/components/style.css">

    <!-- Page-specific styles -->
    <link rel="stylesheet" href="/vehicles/vehicles.css">

    <!-- Centralized navigation -->
    <script src="/components/navbar.js" defer></script>
</head>

<body class="flex h-screen overflow-hidden">

    <!-- Injected sidebar -->
    <div id="sidebar-root"></div>

    <!-- Main -->
    <main class="flex-1 flex flex-col overflow-hidden">

        <!-- Injected header -->
        <div id="header-root"></div>

        <!-- Page Content -->
        <div class="flex-1 overflow-y-auto p-8 bg-slate-50">
            <div class="max-w-7xl mx-auto space-y-6">

                <!-- Filters -->
                <div class="flex items-center gap-2 overflow-x-auto hide-scrollbar pb-2" id="filterBar">
                    <button onclick="filterType('All', this)" class="filter-btn active">All</button>
                    <button onclick="filterType('CAV', this)" class="filter-btn">CAV</button>
                    <button onclick="filterType('APC', this)" class="filter-btn">APC</button>
                    <button onclick="filterType('Pickup', this)" class="filter-btn">Pickup</button>
                    <button onclick="filterType('CITV', this)" class="filter-btn">CITV</button>
                    <button onclick="filterType('Ambulance', this)" class="filter-btn">Ambulance</button>
                </div>

                <!-- Grid -->
                <div id="assetGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="vehicle-card shimmer h-40"></div>
                    <div class="vehicle-card shimmer h-40"></div>
                    <div class="vehicle-card shimmer h-40"></div>
                    <div class="vehicle-card shimmer h-40"></div>
                </div>

            </div>
        </div>
    </main>

    <!-- Page JS (unchanged) -->
    <script>
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQk4gER-Hzbhsw1kmNd2_2-SjwUqQcAGtw6xG9h3tUS_uSpcDTfu2SxU5J4w0XA1A8Llg9cZ6eAIkwu/pub?output=csv'; 
        
        let allVehicles = [];
        let currentFilter = 'All';

        async function fetchSheetData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                if (!response.ok) throw new Error();

                const csvText = await response.text();
                allVehicles = parseCSV(csvText);
                renderAssets();
            } catch {
                document.getElementById('assetGrid').innerHTML =
                    `<div class="col-span-full py-20 text-center text-slate-400">Error loading database</div>`;
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g,'').toLowerCase());

            return lines.slice(1).map(line => {
                const values = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/)
                                   .map(v => v.replace(/"/g,'').trim());
                const row = {};
                headers.forEach((h,i)=>row[h]=values[i]||'');
                return {
                    name: row['vehicle name'],
                    subtitle: row['sub heading'] || '',
                    image: row['image status'],
                    brochure: row['brochure link'],
                    website: row['website'],
                    type: row['category'] || 'Other'
                };
            }).filter(v => v.name);
        }

        function renderAssets() {
            const grid = document.getElementById('assetGrid');
            grid.innerHTML = '';

            const filtered = allVehicles.filter(v =>
                (currentFilter === 'All' || v.type.toUpperCase() === currentFilter) &&
                v.name.toLowerCase().includes('')
            );

            filtered.forEach(v => {
                grid.insertAdjacentHTML('beforeend', `
                    <div class="vehicle-card">
                        <div class="p-5">
                            <span class="category-badge ${getCategoryColor(v.type)}">${v.type}</span>
                            <h3 class="text-sm font-black mt-2">${v.name}</h3>
                            <p class="text-[10px] text-slate-400">${v.subtitle}</p>
                        </div>
                    </div>
                `);
            });
        }

        function getCategoryColor(t) {
            t = t.toUpperCase();
            if (t.includes('CAV')) return 'bg-blue-50 text-blue-600';
            if (t.includes('APC')) return 'bg-red-50 text-red-600';
            return 'bg-slate-100 text-slate-600';
        }

        function filterType(type, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = type;
            renderAssets();
        }

        window.addEventListener('DOMContentLoaded', fetchSheetData);
    </script>

</body>
</html>
