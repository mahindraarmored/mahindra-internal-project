<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEVA Internal | Our Overview</title>
    
    <!-- Tailwind & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- PDF.js Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- PageFlip Engine -->
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --meva-red: #e11d48;
            --portal-dark: #0f172a;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f1f5f9;
            color: #0f172a;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Sync with navbar.js Sidebar Styles */
        .sidebar { background: var(--portal-dark); color: white; width: 260px; flex-shrink: 0; }
        .nav-link { 
            display: flex; align-items: center; gap: 12px; padding: 12px 16px; 
            border-radius: 12px; color: #94a3b8; font-size: 13px; font-weight: 600; 
            transition: all 0.2s; 
        }
        .nav-link.active { background: var(--meva-red); color: white; }
        
        /* Flipbook Styling */
        #flipbook-viewport {
            width: 100%;
            height: calc(100vh - 200px);
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 2000px;
        }

        .stPageFlip {
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            background: white;
        }

        .page { background: white; }
        .page-content { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        canvas { max-width: 100%; max-height: 100%; }

        .lang-btn {
            font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em;
            padding: 8px 16px; border-radius: 99px; transition: all 0.2s; color: #64748b;
        }
        .lang-btn.active { background: #fee2e2; color: var(--meva-red); }

        /* Security Disclaimer Overlay (Synced with navbar.js) */
        #disclaimerOverlay {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(8px); z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .disclaimer-card { background: white; padding: 40px; border-radius: 24px; max-width: 450px; text-align: center; }
        #agreeBtn { background: var(--portal-dark); color: white; padding: 12px 30px; border-radius: 12px; font-weight: 700; margin-top: 20px; }
        .disclaimer-hidden { opacity: 0; pointer-events: none; transition: 0.6s; }
    </style>
</head>
<body>

    <!-- Roots for navbar.js injection -->
    <div id="sidebar-root"></div>

    <div class="flex-1 flex flex-col min-w-0">
        <div id="header-root"></div>

        <main class="flex-1 p-6 lg:p-10 flex flex-col relative">
            
            <!-- Context Header -->
            <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
                <div>
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Our Overview</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mt-1">Multi-Language Product Portfolio</p>
                </div>

                <!-- Language Selector -->
                <div class="bg-white p-1.5 rounded-full shadow-sm border border-slate-200 flex items-center gap-1">
                    <button onclick="switchLanguage('en')" id="btn-en" class="lang-btn active">English</button>
                    <button onclick="switchLanguage('ar')" id="btn-ar" class="lang-btn">العربية</button>
                    <button onclick="switchLanguage('es')" id="btn-es" class="lang-btn">Español</button>
                    <button onclick="switchLanguage('fr')" id="btn-fr" class="lang-btn">Français</button>
                </div>
            </div>

            <!-- Flipbook Container -->
            <div class="flex-1 relative">
                <div id="loading-overlay" class="absolute inset-0 z-10 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center rounded-3xl border border-slate-200">
                    <div class="w-10 h-10 border-4 border-slate-100 border-t-rose-600 rounded-full animate-spin mb-4"></div>
                    <span class="text-[10px] font-black tracking-widest text-slate-400 uppercase">Synchronizing Data</span>
                </div>

                <div id="flipbook-viewport">
                    <div id="book" class="stPageFlip"></div>
                </div>
            </div>

            <!-- Flipbook Navigation -->
            <div class="flex items-center justify-center gap-6 mt-6">
                <button onclick="pageFlip.flipPrev()" class="p-3 bg-white border border-slate-200 rounded-full text-slate-400 hover:text-rose-600 transition-all shadow-sm">
                    <i class="ri-arrow-left-s-line text-2xl"></i>
                </button>
                
                <div class="bg-slate-900 px-6 py-2 rounded-full text-[10px] font-black tracking-widest text-white shadow-lg">
                    PAGE <span id="p-cur" class="text-rose-500">1</span> / <span id="p-tot">0</span>
                </div>

                <button onclick="pageFlip.flipNext()" class="p-3 bg-white border border-slate-200 rounded-full text-slate-400 hover:text-rose-600 transition-all shadow-sm">
                    <i class="ri-arrow-right-s-line text-2xl"></i>
                </button>
            </div>
        </main>
    </div>

    <!-- Inject navbar logic via relative path -->
    <script src="../components/navbar.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const brochures = {
            en: { file: '../downloads/brochure-en.pdf', label: 'Active: English' },
            ar: { file: '../downloads/brochure-ar.pdf', label: 'Active: Arabic' },
            es: { file: '../downloads/brochure-es.pdf', label: 'Active: Spanish' },
            fr: { file: '../downloads/brochure-fr.pdf', label: 'Active: French' }
        };

        let pageFlip = null;

        async function loadBrochure(lang) {
            const overlay = document.getElementById('loading-overlay');
            overlay.style.display = 'flex';
            overlay.style.opacity = '1';

            const config = brochures[lang];
            const bookContainer = document.getElementById('book');
            
            if (pageFlip) { pageFlip.destroy(); bookContainer.innerHTML = ''; }

            try {
                const pdf = await pdfjsLib.getDocument(config.file).promise;
                document.getElementById('p-tot').innerText = pdf.numPages;

                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.5 });
                    
                    const pageDiv = document.createElement('div');
                    pageDiv.className = 'page';
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({ canvasContext: context, viewport: viewport }).promise;
                    
                    const content = document.createElement('div');
                    content.className = 'page-content';
                    content.appendChild(canvas);
                    pageDiv.appendChild(content);
                    bookContainer.appendChild(pageDiv);
                }

                pageFlip = new St.PageFlip(bookContainer, {
                    width: 550, height: 750, size: "stretch", showCover: true,
                    maxShadowOpacity: 0.3, mobileScrollSupport: false
                });

                pageFlip.loadFromHTML(document.querySelectorAll('.page'));
                pageFlip.on('flip', (e) => { document.getElementById('p-cur').innerText = e.data + 1; });

                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.display = 'none', 500);
            } catch (err) {
                overlay.innerHTML = `<div class="text-rose-600 font-bold text-xs uppercase">Error Loading Portfolio</div>`;
                console.error(err);
            }
        }

        function switchLanguage(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${lang}`).classList.add('active');
            loadBrochure(lang);
        }

        // Wait for navbar.js to finish injection before initialization
        window.addEventListener('load', () => {
            // Highlighting the 'Our Overview' link in the injected sidebar
            setTimeout(() => {
                const overviewLink = document.getElementById('nav-overview');
                if (overviewLink) {
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    overviewLink.classList.add('active');
                }
            }, 100);

            loadBrochure('en');
        });
    </script>
</body>
</html>
