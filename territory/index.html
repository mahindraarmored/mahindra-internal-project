<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Global Reach | Mahindra Emirates</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link rel="stylesheet" href="../components/style.css">
    <script src="../components/navbar.js" defer></script>
    <style>
        #map-canvas { height: 100%; width: 100%; background: #f8fafc; z-index: 1; }
        .leaflet-container { font-family: inherit; }
        .custom-popup .leaflet-popup-content-wrapper { border-radius: 12px; padding: 4px; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex h-screen w-screen overflow-hidden bg-[#f8fafc]">
    <div id="sidebar-root"></div>
    <main class="flex-1 flex flex-col h-full overflow-hidden">
        <div id="header-root"></div>
        <div class="flex-1 overflow-y-auto p-8 md:p-12 hide-scrollbar">
            <div class="max-w-6xl mx-auto space-y-8">
                
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                    <div>
                        <h2 class="text-3xl font-black text-slate-900 uppercase tracking-tight">GLOBAL REACH</h2>
                        <p class="text-slate-500 mt-1 font-medium italic">MEVA Operational Zones & Service Hubs.</p>
                    </div>
                    
                    <div class="flex bg-slate-200/50 p-1 rounded-2xl w-fit border border-slate-200 shadow-inner">
                        <button onclick="updateMapMode('countries')" id="btn-countries" class="px-5 py-2 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all bg-white text-slate-900 shadow-sm">
                            Territories
                        </button>
                        <button onclick="updateMapMode('agencies')" id="btn-agencies" class="px-5 py-2 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all text-slate-500 hover:text-slate-700">
                            Agencies
                        </button>
                    </div>
                </div>

                <div class="bg-white border border-slate-200 rounded-3xl p-4 shadow-sm min-h-[600px] relative overflow-hidden flex flex-col">
                    <div class="flex-1 rounded-2xl overflow-hidden relative border border-slate-100" id="map-canvas">
                        </div>
                    
                    <div class="mt-4 flex flex-wrap gap-4 items-center justify-center border-t border-slate-50 pt-4" id="map-legend">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // 1. DATA CONFIGURATION
        const managerColors = {
            "MR. RAJIV": "#3b82f6",    // Blue
            "MR. NADER": "#10b981",    // Green
            "MR. ROWAN": "#f59e0b",    // Amber
            "MR. LYES": "#6366f1",     // Indigo
            "MR. CRISTIAN": "#8b5cf6", // Purple
            "OPEN": "#ef4444"          // Red
        };

        const countries = [
            { name: "Kenya", manager: "MR. RAJIV", coords: [-1.28, 36.81] },
            { name: "Egypt", manager: "MR. NADER", coords: [26.82, 30.80] },
            { name: "Zambia", manager: "MR. ROWAN", coords: [-13.13, 27.84] },
            { name: "Ivory Coast", manager: "MR. LYES", coords: [7.53, -5.54] },
            { name: "Argentina", manager: "MR. CRISTIAN", coords: [-38.41, -63.61] },
            { name: "Vietnam", manager: "OPEN", coords: [14.05, 108.27] }
        ];

        const agencies = [
            { name: "UNOPS LTA", manager: "OPEN", coords: [55.67, 12.56] },
            { name: "ICRC Geneva", manager: "MR. NADER", coords: [46.20, 6.14] },
            { name: "UNHCR", manager: "MR. RAJIV", coords: [46.22, 6.13] },
            { name: "World Bank", manager: "MR. ROWAN", coords: [38.89, -77.04] }
        ];

        // 2. INITIALIZE MAP
        const map = L.map('map-canvas', { 
            center: [20, 10], 
            zoom: 2.5, 
            attributionControl: false,
            zoomControl: false 
        });

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        const countryLayer = L.layerGroup();
        const agencyLayer = L.layerGroup();

        // 3. POPULATE MAP
        function initData() {
            // Add Countries (Circles)
            countries.forEach(c => {
                L.circleMarker(c.coords, {
                    radius: 8,
                    fillColor: managerColors[c.manager],
                    color: "#fff",
                    weight: 2,
                    fillOpacity: 0.8
                }).addTo(countryLayer).bindPopup(`<b>${c.name}</b><br><span class='text-xs'>${c.manager}</span>`);
            });

            // Add Agencies (Icons)
            agencies.forEach(a => {
                const agencyIcon = L.divIcon({
                    html: `<div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white shadow-md border-2" style="border-color:${managerColors[a.manager]}"><i class="ri-government-line text-lg" style="color:${managerColors[a.manager]}"></i></div>`,
                    className: 'custom-div-icon',
                    iconSize: [32, 32]
                });
                L.marker(a.coords, { icon: agencyIcon }).addTo(agencyLayer).bindPopup(`<b>${a.name}</b><br><span class='text-xs'>${a.manager}</span>`);
            });

            countryLayer.addTo(map);
            renderLegend();
        }

        // 4. UI FUNCTIONS
        function updateMapMode(mode) {
            const btnC = document.getElementById('btn-countries');
            const btnA = document.getElementById('btn-agencies');

            if (mode === 'countries') {
                map.removeLayer(agencyLayer);
                countryLayer.addTo(map);
                btnC.className = "px-5 py-2 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all bg-white text-slate-900 shadow-sm";
                btnA.className = "px-5 py-2 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all text-slate-500 hover:text-slate-700";
            } else {
                map.removeLayer(countryLayer);
                agencyLayer.addTo(map);
                btnA.className = "px-5 py-2 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all bg-white text-slate-900 shadow-sm";
                btnC.className = "px-5 py-2 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all text-slate-500 hover:text-slate-700";
            }
        }

        function renderLegend() {
            const container = document.getElementById('map-legend');
            Object.entries(managerColors).forEach(([name, color]) => {
                container.innerHTML += `
                    <div class="flex items-center gap-2">
                        <span class="w-2.5 h-2.5 rounded-full" style="background-color: ${color}"></span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">${name}</span>
                    </div>
                `;
            });
        }

        initData();
    </script>
</body>
</html>
